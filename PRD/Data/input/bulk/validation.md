# וולידציה של קבצי Bulk

## סקירה כללית

תהליך הוולידציה בודק את תקינות קבצי ה-Bulk המגיעים מ-Amazon. הבדיקות מוודאות שהקובץ תואם למבנה הנדרש ומכיל נתונים תקינים.

## בדיקות מבנה

### בדיקת פורמט קובץ
- **סוג קובץ:** Excel (.xlsx) או CSV
- **גודל:** עד 40MB
- **קריאות:** הקובץ נפתח ללא שגיאות
- **קידוד:** UTF-8

### בדיקת Sheet
- **שם Sheet:** "Sponsored Products Campaigns"
- **מיקום:** Sheet ראשון (אם יש כמה)
- **Case Sensitive:** כן

### בדיקת עמודות
- **מספר עמודות:** בדיוק 48
- **סדר עמודות:** חייב להיות מדויק
- **כותרות:** בשורה הראשונה
- **שמות עמודות:** בדיוק כמו ברשימה המוגדרת

## בדיקות נתונים

### בדיקת גודל
- **מספר שורות:** עד 500,000 (כולל כותרת)
- **אורך תא:** עד 255 תווים לתא
- **שורות ריקות:** מסוננות אוטומטית

### Entity Types (עמודה 2)
**ערכים תקינים:**
- Keyword
- Product Targeting
- Product Ad
- Bidding Adjustment
- Campaign
- Ad Group

**טיפול בערכים לא תקינים:** סינון השורה

### State (עמודה 18)
**ערכים תקינים:**
- enabled
- paused
- archived

**טיפול בערכים לא תקינים:** סינון השורה

### Campaign ID (עמודה 4)
- **חובה:** חייב להיות קיים
- **סוג:** מספר
- **ערך ריק:** שורה נדחית

### Portfolio Name (עמודה 14)
- **סוג:** טקסט
- **Case Sensitive:** כן
- **ערך ריק:** מותר

## בדיקות ספציפיות ל-Zero Sales

### Units (עמודה 44)
- **סוג:** מספר או 0
- **ערכים שליליים:** מטופלים כ-0
- **ערך ריק:** מטופל כ-0

### Bid (עמודה 28)
- **סוג:** מספר
- **טווח תקין:** 0.02-1.25
- **מחוץ לטווח:** מעובד אך מסומן בורוד
- **ערך ריק:** מטופל כ-0

### Clicks (עמודה 39)
- **סוג:** מספר
- **ערכים שליליים:** מטופלים כ-0
- **ערך ריק:** מטופל כ-0

## בדיקות התאמה עם Template

### Portfolio Names
- **השוואה:** Portfolio Name מ-Bulk מול Template
- **10 Flat Portfolios:** מותר שיחסרו
- **אחרים חסרים:** שגיאה
- **Case Sensitive:** כן

### לפחות שורה אחת לעיבוד
- **בדיקה:** האם יש שורות עם Units = 0
- **אין שורות:** אזהרה "No rows with Units = 0 found"

## הודעות שגיאה

### שגיאות קריטיות (עוצרות עיבוד)
- "Missing 'Sponsored Products Campaigns' sheet"
- "File exceeds 40MB limit"
- "File has more than 500,000 rows"
- "Incorrect number of columns: found X, expected 48"
- "Missing portfolios: [רשימה]"

### אזהרות (ממשיכות עיבוד)
- "X rows with invalid Entity type filtered"
- "Y rows with invalid State filtered"
- "No rows with Units = 0 found"
- "Z rows with Flat portfolios filtered"

## תהליך הוולידציה

### שלב 1: בדיקת קובץ
1. בדיקת גודל (< 40MB)
2. ניסיון פתיחה
3. חיפוש Sheet הנדרש

### שלב 2: בדיקת מבנה
1. ספירת עמודות (= 48)
2. בדיקת כותרות
3. ספירת שורות (< 500,000)

### שלב 3: בדיקת נתונים
1. סריקת Entity Types
2. בדיקת State values
3. בדיקת Campaign IDs

### שלב 4: התאמה ל-Template
1. השוואת Portfolio Names
2. סינון Flat Portfolios
3. בדיקת שורות עם Units = 0

## סטטיסטיקות וולידציה

המערכת אוספת ומציגה:
- מספר שורות כולל
- מספר שורות אחרי סינון Units = 0
- מספר שורות אחרי סינון Flat Portfolios
- מספר שורות אחרי סינון Ignore portfolios
- מספר שורות סופי לעיבוד

## טיפול בתוצאות

### אם הוולידציה עברה
- הודעה: "Bulk file validated successfully"
- הצגת סטטיסטיקות
- אפשרות להמשיך לעיבוד

### אם יש שגיאות
- הצגת רשימת שגיאות
- אפשרות להעלות קובץ חדש
- שמירת Template בזיכרון

---

**עדכון אחרון:** 18 באוגוסט 2025, 20:00