# מבנה קובץ Template
**נתיב:** `PRD/Data/input/template/structure.md`

## סקירה כללית

קובץ Template מכיל את הגדרות הפורטפוליוז והפרמטרים לאופטימיזציה. זהו קובץ קטן וקריטי שמגדיר איך המערכת תטפל בכל פורטפוליו.

## מאפיינים טכניים

### פורמט קובץ
- **סוג:** Excel (.xlsx) בלבד
- **גודל מקסימלי:** 1MB
- **קידוד:** UTF-8
- **מספר לשוניות:** 2 (חובה)

## מבנה הלשוניות

### לשונית 1: Port Values (חובה)

#### מבנה העמודות

| מספר | שם עמודה | סוג | חובה | תיאור |
|------|-----------|-----|------|--------|
| A | Portfolio Name | String | כן | שם הפורטפוליו |
| B | Base Bid | Number/String | כן | הצעת בסיס |
| C | Target CPA | Number | לא | יעד CPA |

#### כללי עמודות

##### Portfolio Name (עמודה A)
- **סוג:** טקסט חופשי
- **אורך:** עד 255 תווים
- **ייחודיות:** חייב להיות ייחודי (אין כפילויות)
- **Case Sensitive:** כן
- **ערכים ריקים:** לא מותר

##### Base Bid (עמודה B)
- **ערכים תקינים:**
  - מספר: 0.02 עד 999.99
  - טקסט: "Ignore" (בדיוק כך)
- **דיוק:** עד 2 ספרות אחרי הנקודה
- **ערך ריק:** לא מותר
- **משמעות "Ignore":** לא לבצע אופטימיזציה לפורטפוליו זה

##### Target CPA (עמודה C)
- **ערכים תקינים:**
  - מספר: 0.01 עד 9999.99
  - ריק/null
- **דיוק:** עד 2 ספרות אחרי הנקודה
- **ערך ריק:** מותר
- **משמעות ריק:** להשתמש רק ב-Base Bid בחישובים

### לשונית 2: Top ASINs (אופציונלית - TBC)

#### מבנה העמודות

| מספר | שם עמודה | סוג | חובה | שימוש |
|------|-----------|-----|------|--------|
| A | ASIN | String | לא | לשימוש עתידי |

#### הערות
- **סטטוס:** TBC - לא בשימוש כרגע
- **מטרה עתידית:** אופטימיזציות מבוססות ASIN
- **אפשר להשאיר ריקה:** כן

## דוגמאות

### דוגמה 1: Template בסיסי

**Port Values:**
```
Portfolio Name    | Base Bid | Target CPA
-----------------|----------|------------
Kids-Brand-US    | 1.25     | 5.00
Kids-Brand-EU    | 0.95     | 
Supplements-US   | Ignore   | 
Supplements-EU   | 2.10     | 8.50
```

**Top ASINs:**
```
ASIN
-----------
(ריק - TBC)
```

### דוגמה 2: Template עם Flat Portfolios

**Port Values:**
```
Portfolio Name    | Base Bid | Target CPA
-----------------|----------|------------
Electronics-US   | 1.50     | 10.00
Flat 30         | 0.75     | 3.00
Books-UK        | 0.45     | 2.50
Flat 25 | Opt   | 1.00     | 
```

**הערה:** Flat 30 ו-Flat 25 | Opt יסוננו אוטומטית

## וולידציות נדרשות

### בדיקות מבנה
1. **קיום לשוניות:** חייבות להיות 2 לשוניות
2. **שמות לשוניות:** "Port Values" ו-"Top ASINs"
3. **סדר עמודות:** Portfolio Name, Base Bid, Target CPA (בדיוק בסדר זה)
4. **כותרות עמודות:** חייבות להיות בשורה הראשונה

### בדיקות נתונים

#### Portfolio Name
- אין כפילויות
- אין ערכים ריקים
- אין תווים אסורים (/, \, *, ?, <, >, |)

#### Base Bid
- טווח: 0.02-999.99 או "Ignore"
- אין ערכים ריקים
- אין טקסט אחר מלבד "Ignore"

#### Target CPA
- טווח: 0.01-9999.99 או ריק
- אם קיים, חייב להיות מספר חיובי

## טיפול בשגיאות

### שגיאות קריטיות (עוצרות עיבוד)
- חסרה לשונית Port Values
- סדר עמודות שגוי
- Portfolio Names כפולים
- כל הפורטפוליוז מסומנים כ-"Ignore"

### אזהרות (ממשיכות עיבוד)
- Target CPA חסר ברוב השורות
- Base Bid גבוה מאוד (>5.00)
- Portfolio Names עם תווים מיוחדים

## השוואה ל-Bulk

### בדיקת התאמה
המערכת משווה את Portfolio Names מ-Template מול "Portfolio Name (Informational only)" ב-Bulk:
1. אם חסרים פורטפוליוז (ולא ברשימת Flat) - שגיאה
2. אם כל הפורטפוליוז ב-Template הם "Ignore" - שגיאה
3. אם יש פורטפוליוז עודפים ב-Template - OK (לא משפיע)

## ביצועים

### זמני קריאה צפויים
| גודל | מספר portfolios | זמן קריאה |
|------|-----------------|-----------|
| <100KB | עד 100 | <1 שנייה |
| 100-500KB | 100-1000 | 1-2 שניות |
| 500KB-1MB | 1000+ | 2-3 שניות |

## הערות חשובות

1. **לשונית Top ASINs:** חובה שתהיה קיימת, אפשר להשאיר ריקה
2. **Case Sensitive:** כל ההשוואות רגישות לאותיות גדולות/קטנות
3. **Flat Portfolios:** גם אם מופיעים ב-Template, יסוננו באופטימיזציה
4. **"Ignore":** בדיוק כך, לא "ignore" או "IGNORE"
5. **סדר השורות:** לא משנה, המערכת קוראת לפי Portfolio Name

---

**עדכון אחרון:** 18 באוגוסט 2025, 12:45