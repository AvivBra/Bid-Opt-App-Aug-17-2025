# מפרט חוזה אופטימיזציה
## תאריך: 30 באוגוסט 2025 | שעה: 13:15

---

## 1. הגדרת החוזה הבסיסי

### 1.1 כל אסטרטגיית אופטימיזציה חייבת לממש פונקציה אחת ויחידה
- שם הפונקציה: run
- קלט: מילון של כל הגיליונות מהקובץ המקורי
- פלט: אובייקט תוצאה מוגדר

### 1.2 מבנה אובייקט התוצאה - שדות חובה
- **סוג התוצאה**: האם מעדכנים קמפיינים או פורטפוליוז
- **מפתחות מיזוג**: איך לזהות את השורות לעדכון
- **תיקון**: רק השורות שהשתנו, לא כל הנתונים

### 1.3 כללי עיבוד נתונים
- אסור לשנות את הנתונים המקוריים ישירות אלא על העתק של הנתונים תוך שמירת נוסח המקור במקביל. הפלט יהיה נוסח שעבר שינויים
- חובה לעבוד על העתק של הנתונים
- אסור להחזיר את כל הנתונים, רק את השינויים

---

## 2. מבנה נתוני הפלט

### 2.1 התיקון חייב להכיל
- רק שורות שבאמת השתנו
- את המזהה הייחודי של כל שורה
- את הערכים החדשים לעמודות שהשתנו
- אינדקס מדויק של מיקום השורה במקור

### 2.2 מטריקות ביצוע
- כמה שורות נבדקו
- כמה שורות עודכנו
- כמה שורות נכשלו
- זמן עיבוד

### 2.3 הודעות למשתמש
- סטטוס הצלחה או כישלון
- אזהרות על נתונים חריגים
- המלצות לפעולה

---

## 3. סוגי תוצאות מותרים

### 3.1 עדכון קמפיינים
- סוג תוצאה: campaigns
- גיליון יעד: Sponsored Products Campaigns
- מפתח מיזוג: Campaign ID

### 3.2 עדכון פורטפוליוז
- סוג תוצאה: portfolios
- גיליון יעד: Portfolios
- מפתח מיזוג: Portfolio ID

### 3.3 אסור להוסיף סוגי תוצאות חדשים
- רק שני הסוגים לעיל מותרים
- כל סוג אחר יידחה אוטומטית

---

## 4. עקרונות מנחים

### 4.1 עקרון המינימום
- להחזיר רק את מה שהשתנה
- לא להעביר נתונים מיותרים
- לחסוך בזיכרון ובזמן עיבוד

### 4.2 עקרון השקיפות
- לדווח בדיוק מה השתנה
- להסביר למה דברים השתנו
- לתת למשתמש שליטה מלאה

### 4.3 עקרון הבטיחות
- לא לפגוע בנתונים קיימים
- לאפשר ביטול שינויים
- לתעד כל פעולה

---

## 5. תהליך אימות החוזה

### 5.1 בדיקות קלט
- וודא שכל הגיליונות הנדרשים קיימים
- וודא שהעמודות הנדרשות קיימות
- וודא שיש נתונים לעיבוד

### 5.2 בדיקות פלט
- וודא שסוג התוצאה תקין
- וודא שמפתחות המיזוג קיימים
- וודא שהתיקון מכיל רק שינויים

### 5.3 בדיקות שלמות
- וודא שכל שורה שהשתנתה מתועדת
- וודא שאין כפילויות במפתחות
- וודא שהמטריקות מדויקות

---

## 6. טיפול בשגיאות

### 6.1 שגיאות קלט
- גיליון חסר: דווח והפסק
- עמודה חסרה: דווח והמשך אם אפשר
- נתונים פגומים: דלג ודווח

### 6.2 שגיאות עיבוד
- חישוב נכשל: דלג על השורה
- ערך לא תקין: השאר מקורי
- תנאי לא מתקיים: דלג

### 6.3 שגיאות פלט
- תיקון ריק: דווח שאין שינויים
- תיקון גדול מדי: חלק לקבוצות
- תיקון לא תקין: בטל ודווח

---

## 7. דוגמאות יישום

### 7.1 פורטפוליוז ריקים
- סוג תוצאה: portfolios
- מזהה: פורטפוליוז בלי קמפיינים
- שינוי: שם חדש מספרי
- מפתח: Portfolio ID

### 7.2 קמפיינים ללא פורטפוליו
- סוג תוצאה: campaigns
- מזהה: קמפיינים עם פורטפוליו ריק
- שינוי: הקצאת פורטפוליו ברירת מחדל
- מפתח: Campaign ID

---

## 8. הגבלות ואילוצים

### 8.1 גודל מקסימלי
- מקסימום 500,000 שורות בתיקון
- מקסימום 500,000 שורות לעיבוד
- מקסימום 40 מגה לקובץ

### 8.2 זמן עיבוד
- מקסימום 30 שניות לאופטימיזציה
- מקסימום 2 דקות לתהליך מלא
- טיימאאוט אוטומטי אחרי 5 דקות

### 8.3 עמודות מוגנות
- אסור לשנות: Entity
- אסור לשנות: Campaign ID
- אסור לשנות: Portfolio ID

---

## 9. תאימות לאחור

### 9.1 גרסאות נתמכות
- פורמט Excel 2007 ומעלה
- פורמט CSV סטנדרטי
- קידוד UTF-8

### 9.2 שינויים עתידיים
- הוספת סוגי תוצאה חדשים דורשת עדכון חוזה
- שינוי מבנה הפלט דורש הודעה מראש
- כל שינוי חייב להיות תואם לאחור

---

## 10. סיכום ואכיפה

### 10.1 החוזה מחייב
- כל אסטרטגיה חייבת לעמוד בחוזה
- אי עמידה בחוזה תגרום לדחייה
- בדיקות אוטומטיות יאכפו את החוזה

### 10.2 תיעוד
- כל אסטרטגיה חייבת תיעוד מלא
- התיעוד חייב להתאים לחוזה
- דוגמאות קוד אסורות בתיעוד

### 10.3 עדכונים
- החוזה יעודכן רק בגרסאות ראשיות
- שינויים יתועדו בלוג שינויים
- תינתן תקופת מעבר של חודש