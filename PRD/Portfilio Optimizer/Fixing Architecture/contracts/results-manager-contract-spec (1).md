# מפרט חוזה מנהל תוצאות
## תאריך: 30 באוגוסט 2025 | שעה: 13:25

---

## 1. טבלת מיפוי

### סוג תוצאה לגיליון יעד
- campaigns → Sponsored Products Campaigns
- portfolios → Portfolios

לא מותרים סוגים אחרים.

---

## 2. אלגוריתם מיזוג

### תהליך העבודה
1. קח את הנתונים המקוריים
2. זהה שורות לעדכון לפי מפתח המיזוג
3. החלף רק את העמודות שהשתנו
4. שמור את השאר כמו שהיה

### כללי מיזוג
- עדכן רק שורות עם מפתח תואם
- אל תוסיף שורות חדשות
- אל תמחק שורות קיימות

---

## 3. קונפליקטים

### מדיניות
- האחרון גובר
- תעד בלוג
- המשך עיבוד

### תיעוד קונפליקט
- איזו אופטימיזציה דרסה
- איזו אופטימיזציה נדרסה
- איזה ערך השתנה

---

## 4. עמודות מוגנות

### אסור לעדכן
- Entity
- Campaign ID (בקמפיינים)
- Portfolio ID (בפורטפוליוז)

### מותר לעדכן
- Portfolio Name
- Operation
- Budget Amount
- כל עמודה אחרת שאינה מוגנת

---

## 5. דוח ריצה

### מטריקות חובה
- כמה אופטימיזציות רצו
- כמה הצליחו
- כמה שורות עודכנו בכל גיליון
- זמן כולל

### פירוט לכל אופטימיזציה
- שם
- סטטוס
- שורות שעודכנו
- הודעות

---

## 6. סדר עיבוד

### רצף קבוע
1. empty_portfolios
2. campaigns_without_portfolios
3. אופטימיזציות עתידיות לפי סדר הגדרה

### חוקי עיבוד
- תמיד על הנתונים המעודכנים
- כל אופטימיזציה רואה את השינויים הקודמים
- אין עיבוד מקבילי

---

## 7. יצירת קובץ פלט

### מבנה
- גיליון ראשון: Sponsored Products Campaigns
- גיליון שני: Portfolios

### עיצוב
- סימון שורות מעודכנות בצהוב
- פורמט טקסט למניעת סימון מדעי
- שמירת כל העמודות המקוריות

---

## 8. טיפול בכשלונות

### אופטימיזציה נכשלה
- דלג עליה
- תעד בדוח
- המשך לבאה

### נתונים חסרים
- השאר מקורי
- דווח למשתמש
- אל תעצור תהליך

---

## 9. אימות

### לפני מיזוג
- בדוק שמפתח קיים
- בדוק שעמודה מותרת
- בדוק סוג נתון

### אחרי מיזוג
- ספור שורות מעודכנות
- וודא שלמות נתונים
- בדוק שאין אובדן מידע

---

## 10. ביצועים

### מגבלות
- מקסימום 500,000 שורות
- מקסימום 10 אופטימיזציות
- מקסימום 2 דקות זמן ריצה

### אופטימיזציה
- עבוד על אינדקסים לא על נתונים מלאים
- מזג בבת אחת לא שורה-שורה
- שמור רק שינויים לא העתקים