# Organize Top Campaigns - איפיון תהליך

**תאריך:** 01/09/2025  
**שעה:** 14:00

## תיאור האופטימיזציה
אופטימיזציה בעמוד Portfolio Optimizer בשם "Organize Top Campaigns".

## דרישות ממשק
עבור האופטימיזציה הזאת צריך להוסיף:
- כפתור **Download Template** בשלב העלאת הקבצים
- כפתור **Upload Template**

## מבנה הטמפלט להורדה
- לשונית אחת
- עמודה אחת עם כותרת: **Top ASINs**

## סדר האירועים

### 1. בחירת האופטימיזציה
המשתמש מסמן בעמוד Portfolio Optimizer את הצ'קבוקס **Organize Top Campaigns** (כאשר רק צ'קבוקס זה מסומן)

### 2. הורדת והעלאת טמפלט
- המערכת מציגה את כפתור ההורדה
- המשתמש לוחץ ומוריד את הטמפלט
- המשתמש ממלא את הטמפלט
- המשתמש מעלה את הטמפלט המלא
- המשתמש מעלה בנוסף קובץ Bulk 60

### 3. תחילת עיבוד
המשתמש לוחץ על כפתור Processing

## תהליך העיבוד

### שלב 1: ולידציה
ולידציה לפי קובץ הולידציה הבסיסי של העמוד (קיים כבר)

### שלב 2: ניקוי
ניקוי לפי קובץ הניקוי שקיים כבר לעמוד הזה

### שלב 3: הוספת עמודה Ads Count
- מוסיפים עמודה מימין לעמודה **Operation** בלשונית **Campaign**
- קוראים לה **Ads Count**
- מיישמים נוסחה מקבילה ל-COUNTIFS:
  - עבור כל שורה ב-**Campaign** מוצאים את הערך בעמודה **Campaign ID**
  - סופרים כמה פעמים הערך הזה מופיע בלשונית **Product Ad** בעמודה **Campaign ID**
  - רושמים את המספר הזה בלשונית **Campaign** בעמודה **Ads Count** בשורה הרלוונטית
- מתעלמים מכל השורות שעונות על אחד התנאים:
  - Portfolio Name (Informational only) = Pause
  - Portfolio Name (Informational only) = Terminal
  - Portfolio Name (Informational only) = Top Terminal
- עבור השורות שלא מתעלמים מהן - מוחקים כל שורה שיצא לה ערך גבוה מ-1 בעמודה **Ads Count**

### שלב 4: מחיקת שורות נוספות
מוחקים כל שורה שאינה בשורות להתעלמות אם היא עונה על לפחות אחד מהתנאים:
- Portfolio Name (Informational only) contains "Flat"
- Portfolio Name (Informational only) contains "Same"
- Portfolio Name (Informational only) contains "Defense"
- Portfolio Name (Informational only) contains "Offense"

### שלב 5: עיבוד ייחודי לפונקציה

#### שלב 5א: יצירת עמודה ASIN PA
- יוצר עמודה נוספת בלשונית **Campaign** בשם **ASIN PA**
- ממקם את העמודה מימין לעמודה **Operation** בלשונית **Campaign**
- צובע את הכותרת בכחול
- ממלא אותה במספרי אסין על ידי פונקציה מקבילה ל-VLOOKUP:
  - עבור כל שורה בלשונית **Campaign** הוא מוצא את הערך בעמודה **Campaign ID** שבה
  - מחפש בלשונית **Product Ad** את השורה שה-**Campaign ID** שבה זהה לזה שבלשונית **Campaign**
  - מהשורה הזאת הוא מביא את הערך שבעמודה **ASIN**
  - שם אותו בשורה הרלוונטית בלשונית **Campaign** בעמודה **ASIN PA**

#### שלב 5ב: יצירת עמודה Top
- יוצר עמודה נוספת לימין העמודה **ASIN PA** בלשונית **Campaign**
- קורא לעמודה החדשה **Top**

#### שלב 5ג: יצירת לשונית Top
- יוצר לשונית נוספת בקובץ הפלט וקורא לה **Top**
- מדביק שם את התוכן של הטמפלט - בעצם עמודה אחת עם רשימת **Top ASINs**

#### שלב 5ד: מילוי עמודה Top
- מיישם שוב פונקציה שדומה ל-VLOOKUP:
  - עבור כל שורה בלשונית **Campaign** הוא בודק מה הערך בעמודה **ASIN PA**
  - הולך ומחפש את הערך הזה בעמודה **Top ASINs** בלשונית החדשה **Top**
  - אם הוא מוצא שהאסין קיים שם הוא מסמן **V** בעמודה **Top** בלשונית **Campaign**
  - אם לא - הוא מדלג